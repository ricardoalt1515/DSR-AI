# Intake Panel UI/UX Simplification Plan

> **Version**: 3.0 (Post-implementation review)
> **Status**: Phase 1-6 COMPLETE. Cleanup phase required.

---

## Implementation Status

| Phase | Status | Notes |
|-------|--------|-------|
| 1. Store Cleanup | DONE | Selection removed, filter simplified |
| 2. Component Deletion | DONE | 7 files deleted |
| 3. Card Redesign | DONE | New design implemented |
| 4. Conflicts & Summary | DONE | Simplified |
| 5. Filters & Section | DONE | Single dropdown |
| 6. Animation & Polish | DONE | Scroll + highlight |

**Code reduction achieved**: ~55% (target was 62%)

---

## Phase 7: Post-Implementation Cleanup (NEW)

### 7.1 URGENT - Before Merge

#### 7.1.1 Extract `ConfidenceIndicator` (duplicated)
**Files**: `suggestion-card.tsx:13-27`, `conflict-card.tsx:13-27`

Create: `confidence-indicator.tsx`
```tsx
interface ConfidenceIndicatorProps {
  confidence: number;
  size?: "sm" | "md";
}

export function ConfidenceIndicator({ confidence, size = "md" }: ConfidenceIndicatorProps) {
  const sizeClasses = size === "sm" ? "text-xs gap-1" : "text-sm font-medium gap-1.5";
  const dotSize = size === "sm" ? "h-1.5 w-1.5" : "h-2 w-2";
  
  return (
    <span className={cn(
      "tabular-nums flex items-center", sizeClasses,
      confidence >= 85 && "text-success",
      confidence >= 70 && confidence < 85 && "text-warning",  // FIX: was 60, tooltip says 70
      confidence < 70 && "text-destructive",
    )}>
      <span className={cn("inline-block rounded-full bg-current", dotSize)} />
      {confidence}%
    </span>
  );
}
```

Update imports in `suggestion-card.tsx` and `conflict-card.tsx`.

#### 7.1.2 Add Accessibility (missing)
**File**: `suggestion-card.tsx:149-176`

Add aria-labels to buttons:
```tsx
<Button
  aria-label={`Skip ${suggestion.fieldLabel} suggestion`}
  ...
>
  Skip
</Button>
<Button
  aria-label={`Apply ${suggestion.fieldLabel} value`}
  ...
>
  Apply
</Button>
```

#### 7.1.3 Add `prefers-reduced-motion` support
**File**: `suggestion-card.tsx:75-80`

```tsx
import { useReducedMotion } from "framer-motion";
// ...
const shouldReduceMotion = useReducedMotion();
// ...
transition={{ duration: shouldReduceMotion ? 0 : 0.2 }}
```

#### 7.1.4 Fix touch target size
**File**: `suggestion-card.tsx:129-136`

Add padding to "Show more" button:
```tsx
<button
  type="button"
  onClick={() => setIsExpanded(true)}
  className="mt-1 py-2 px-1 text-xs text-primary flex items-center gap-0.5 hover:underline"
>
```

---

### 7.2 HIGH - Remove Dead Code

#### 7.2.1 Remove unused store methods
**File**: `intake-store.ts`

Remove:
- `rejectSuggestions` (L251-272) - batch reject no longer in UI
- `rejectConflictSiblings` - called by removed batch flow
- `undoStack`, `pushUndo`, `popUndo`, `undoBatchOperation` (L92-97, L426-460) - no undo UI
- `autoResolveAllConflicts` (L345-408) - UI handler removed

#### 7.2.2 Remove orphaned type helper
**File**: `lib/types/intake.ts:66`

Remove:
- `getConfidenceBadgeVariant()` - `ConfidenceBadge` deleted
- `getConfidenceLevel()` - if unused

#### 7.2.3 Remove unused type
**File**: `lib/api/intake.ts:65-68`

Remove:
```tsx
export interface IntakeSuggestionBatchRequest {
  suggestionIds: string[];
  status: IntakeSuggestionBatchStatus;
}
```

#### 7.2.4 Evaluate `flying-value-target.tsx`
**File**: `frontend/components/features/projects/flying-value-target.tsx`

Check if still imported by `dynamic-section.tsx`. If only used for highlight (no flying), rename or simplify.

---

### 7.3 MEDIUM - Store Simplifications

#### 7.3.1 Remove redundant state
**File**: `intake-store.ts`

Remove `unmappedNotesCount` - derive from `unmappedNotes.length`:
```tsx
// Remove from state
unmappedNotesCount: number;
setUnmappedNotesCount: (count: number) => void;

// Add selector instead
export const useUnmappedNotesCount = () =>
  useIntakePanelStore((state) => state.unmappedNotes.length);
```

#### 7.3.2 Remove duplicate action
**File**: `intake-store.ts`

Remove `removeUnmappedNote` - keep only `dismissUnmappedNote` (same logic).

#### 7.3.3 Extract conflict detection helper
**File**: `intake-store.ts`

Extract (used 3x):
```tsx
function getFieldKey(s: { sectionId: string; fieldId: string }): string {
  return `${s.sectionId}:${s.fieldId}`;
}

function buildFieldCounts(suggestions: AISuggestion[]): Map<string, number> {
  const counts = new Map<string, number>();
  for (const s of suggestions) {
    const key = getFieldKey(s);
    counts.set(key, (counts.get(key) ?? 0) + 1);
  }
  return counts;
}
```

---

### 7.4 MEDIUM - UI Component Improvements

#### 7.4.1 Add "Show less" toggle
**File**: `suggestion-card.tsx:126-139`

```tsx
{isLongValue && (
  <button
    type="button"
    onClick={() => setIsExpanded(!isExpanded)}
    className="mt-1 py-2 text-xs text-primary flex items-center gap-0.5 hover:underline"
  >
    {isExpanded ? "Show less" : "Show more"}
    <ChevronDown className={cn("h-3 w-3 transition-transform", isExpanded && "rotate-180")} />
  </button>
)}
```

#### 7.4.2 Add loading spinner to batch apply
**File**: `intake-summary-bar.tsx:56-64`

```tsx
const [isApplying, setIsApplying] = useState(false);

const handleApplyHighConfidence = async () => {
  setIsApplying(true);
  try {
    const affectedIds = applyHighConfidence();
    if (affectedIds.length > 0) {
      await onApplyHighConfidence(affectedIds);
    }
  } finally {
    setIsApplying(false);
  }
};

<Button disabled={disabled || isApplying}>
  {isApplying ? <Loader2 className="h-3.5 w-3.5 animate-spin" /> : <CheckCircle2 className="h-3.5 w-3.5" />}
  Apply All High-Conf
</Button>
```

#### 7.4.3 Fix type cast
**File**: `suggestion-filters.tsx:38`

```tsx
function isActiveFilter(v: string): v is ActiveFilter {
  return ["all", "high", "notes", "files"].includes(v);
}

onValueChange={(v) => isActiveFilter(v) && setActiveFilter(v)}
```

#### 7.4.4 Remove unused prop
**File**: `ai-suggestions-section.tsx:47`

Remove `projectId` from props interface if unused.

---

### 7.5 LOW - Integration Simplifications

#### 7.5.1 Consolidate store selectors
**File**: `intake-store.ts` (add at bottom)

```tsx
export function useIntakeMutations() {
  return useIntakePanelStore(
    useShallow((state) => ({
      applySuggestion: state.applySuggestion,
      applySuggestions: state.applySuggestions,
      rejectSuggestion: state.rejectSuggestion,
      revertSuggestion: state.revertSuggestion,
      resolveConflict: state.resolveConflict,
      dismissUnmappedNote: state.dismissUnmappedNote,
      dismissUnmappedNotes: state.dismissUnmappedNotes,
    })),
  );
}
```

Use in `intake-panel-content.tsx` to replace 15 separate selectors.

#### 7.5.2 Extract suggestion handlers hook
**File**: Create `use-suggestion-handlers.ts`

Move ~150 lines of handler logic from `intake-panel-content.tsx` to dedicated hook.

---

## Estimated Effort

| Priority | Items | Est. Time |
|----------|-------|-----------|
| 7.1 URGENT | 4 items | 2 hours |
| 7.2 HIGH | 4 items | 1 hour |
| 7.3 MEDIUM | 3 items | 1 hour |
| 7.4 MEDIUM | 4 items | 1.5 hours |
| 7.5 LOW | 2 items | 2 hours |
| **Total** | **17 items** | **~7.5 hours** |

---

## Verification

After Phase 7:
```bash
cd frontend && bun run check:ci
```

Manual testing:
1. Screen reader: Verify Skip/Apply buttons announce field context
2. Mobile: Verify "Show more" button is tappable (44x44px)
3. Reduced motion: Disable animations in OS, verify no jarring transitions
4. Batch apply: Verify spinner shows during operation

---

## Decision Required

**Batch confirmation removal** - The `ConfirmBatchReplaceDialog` was deleted. Users can now overwrite existing field values without warning when using "Apply All High-Conf".

Options:
1. **Accept** - Document as intentional simplification (single-item confirm still works)
2. **Restore** - Re-implement batch confirmation for overwrites only
3. **Prevent** - Filter out suggestions that would overwrite from batch apply

Recommendation: Option 1 (Accept) - Single-item confirmation covers most cases. Batch is for high-confidence items which rarely conflict with existing data.
