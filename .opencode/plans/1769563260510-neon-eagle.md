# Intake Panel UI/UX Improvement Plan

## Current Problems

### 1. Scalability Issues
- Flat list overwhelms with 20+ suggestions
- No visual grouping/hierarchy
- Infinite scroll without virtualization

### 2. Mixed Sources Confusion  
- File suggestions vs Notes suggestions look nearly identical
- Only small badge/icon distinguishes source
- No way to filter/view by source quickly

### 3. Cognitive Overload
- Too many visual elements per suggestion (4 rows each)
- Competing CTAs (IntakeSummaryBar + BatchToolbar + individual actions)
- Conflicts shown separately from suggestions

### 4. Interaction Friction
- Must individually review each suggestion
- No section-level batch actions
- Flying value animation adds latency without value

---

## Proposed Improvements

### Priority 1: Quick Wins (1 week)

#### A. Condensed Suggestion Row (2 rows instead of 4)
```
[x] Field Label                    [95%] [Apply][X]
    Section Name Â· [Notes] or [file.pdf p.2]
```
- Remove separate value badge row (value goes in field label area)
- Combine source + section on single line
- Remove flying animation (a11y + performance)

#### B. Source Badge Color Coding
- **Notes**: Emerald badge (`bg-emerald-500/10 text-emerald-600`)
- **Files**: Blue badge (`bg-blue-500/10 text-blue-600`)
- Visual differentiation at glance

#### C. Sticky Summary Bar
- Pin IntakeSummaryBar to top of suggestions list
- Always visible stats + "Apply All High-Conf" CTA

---

### Priority 2: Core Refactor (2 weeks)

#### D. Grouped List Architecture
Group suggestions by **section** using Accordion:

```
[v] General Information (5)           [Apply 3 high-conf]
    - Company Name    [Notes] 95%    [Apply][X]
    - Contact Email   [quote.pdf] 88% [Apply][X]
    - Phone Number    [Notes] 72%    [Apply][X]
    
[>] Site Details (8)                  [Apply 6 high-conf]
    (collapsed)

[>] Equipment (12)                    [Apply 4 high-conf]
    (collapsed)
```

Benefits:
- Sections can be collapsed to reduce visual noise
- Per-section batch apply button
- Natural hierarchy matches questionnaire structure

#### E. Inline Conflict Resolution
Move conflicts INTO the grouped list (not separate cards):

```
[v] General Information (5)
    - Company Name    [!] CONFLICT
      [o] "Acme Corp" [Notes] 95%
      [ ] "Acme Inc" [quote.pdf] 78%
      [Apply Selected]
```

#### F. View Toggle: Section vs Source
Add toggle to switch grouping:
- **By Section** (default): Groups by questionnaire section
- **By Source**: Groups by file/notes source

```
[By Section] [By Source]
```

---

### Priority 3: Scale & Polish (2+ weeks)

#### G. Virtualization
- Use `@tanstack/react-virtual` for 50+ suggestions
- Render only visible rows + buffer
- Constant DOM size regardless of list length

#### H. Unmapped Notes Redesign
- Show inline as "low-confidence suggestions" 
- Remove separate collapsible section
- Same visual treatment, just filtered

#### I. Simplified Filter Bar
Replace 3 dropdowns with filter chips:

```
[High Conf] [Medium] [Low] | [Notes] [Files] | [Section v]
```

Chips toggle on/off, section is single dropdown.

---

## Component Changes

### Files to Modify
1. `suggestion-row.tsx` - Condense to 2 rows, add color-coded source badge
2. `ai-suggestions-section.tsx` - Add grouped list, view toggle, sticky summary
3. `conflict-card.tsx` - Refactor into inline variant
4. `suggestion-filters.tsx` - Replace with chip-based filter
5. `unmapped-notes-section.tsx` - Consider merging into suggestions list

### New Components
- `grouped-suggestions.tsx` - Accordion-based grouped list
- `source-badge.tsx` - Reusable colored source indicator
- `inline-conflict.tsx` - Conflict resolution within group

---

## Wireframes

### Current Layout
```
+---------------------------+
| IntakeNotesSection        |
+---------------------------+
| QuickUploadSection        |
+---------------------------+
| ConflictCard (separate)   |
| ConflictCard              |
+---------------------------+
| AISuggestionsSection      |
|   SummaryBar              |
|   Filters                 |
|   SuggestionRow           |
|   SuggestionRow           |
|   SuggestionRow (flat)    |
|   ...                     |
|   BatchToolbar (floating) |
+---------------------------+
| UnmappedNotesSection      |
+---------------------------+
```

### Proposed Layout
```
+---------------------------+
| IntakeNotesSection        |
+---------------------------+
| QuickUploadSection        |
+---------------------------+
| AISuggestionsSection      |
|   StickyHeader:           |
|     [Stats] [Apply All]   |
|     [Filter Chips] [View] |
|   GroupedList (Accordion):|
|     [Section A] (5)       |
|       - Suggestion        |
|       - Suggestion        |
|       - ConflictInline    |
|     [Section B] (8)       |
|       (collapsed)         |
|   BatchToolbar (bottom)   |
+---------------------------+
```

---

## Implementation Order

### Week 1
- [ ] Condense SuggestionRow to 2 rows
- [ ] Add source badge color coding
- [ ] Remove flying animation
- [ ] Make summary bar sticky

### Week 2
- [ ] Implement grouped list with Accordion
- [ ] Add view toggle (section/source)
- [ ] Move conflicts inline

### Week 3
- [ ] Refactor filter bar to chips
- [ ] Merge unmapped notes into low-conf suggestions
- [ ] Add virtualization

---

## Decisions Made
1. **Grouping default**: By Section (matches questionnaire structure)
2. **Unmapped notes**: Keep separate collapsible section (different workflow)
3. **Mobile**: Keep Drawer pattern (just improve internal content)
